---
title: 'Steph Curry: The Game Changer'
author: Grady Munro, Logan Pampel, and Mateo Useche Rosania
output: 
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    code_download: true
    theme: cerulean
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)
```

```{r, libraries}
library(readr)
library(tidyverse)     # for data cleaning and plotting
library(lubridate)     # for date manipulation
library(openintro)     # for the abbr2state() function
library(maps)          # for map data
library(ggmap)         # for mapping points on maps
library(gplots)        # for col2hex() function
library(RColorBrewer)  # for color palettes
library(sf)            # for working with spatial data
library(leaflet)       # for highly customizable mapping
library(ggthemes)      # for more themes (including theme_map())
library(plotly)        # for the ggplotly() - basic interactivity
library(gganimate)     # for adding animation layers to ggplots
library(gifski)        # for creating the gif (don't need to load this library every time,but need it installed)
library(transformr)    # for "tweening" (gganimate)
library(shiny)         # for creating interactive apps
library(patchwork)     # for nicely combining ggplot2 graphs  
library(gt)            # for creating nice tables
library(rvest)         # for scraping data
library(robotstxt)     # for checking if you can scrape data
library(janitor)
library(reshape2)
library(hablar) # Might need to install the hablar package, this gives you the retype function.
library(zoo)
```

```{r, reading in data}
curry_web <- read_html("https://www.basketball-reference.com/players/c/curryst01.html")
warriors_web <- read_html("https://www.basketball-reference.com/teams/GSW/stats_per_game_totals.html")
league_web <- read_html("https://www.basketball-reference.com/leagues/NBA_stats_per_game.html")
lebron_web <- read_html("https://www.basketball-reference.com/players/j/jamesle01.html")
jordan_web <- read_html("https://www.basketball-reference.com/players/j/jordami01.html")
three_point_career_web <- read_html("https://www.basketball-reference.com/leaders/fg3_career.html")

curry_career_regular_season_per_game <- curry_web %>% 
  html_element("#per_game") %>% 
  html_table() %>% 
  clean_names() %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>%
  mutate(player = "Stephen Curry")

curry_career_playoffs_per_game <- curry_web %>% 
  html_element("#div_playoffs_per_game") %>% 
  html_table() %>% 
  clean_names() %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>% 
  mutate(player = "Stephen Curry")

warriors_per_game_stats <- warriors_web %>% 
  html_element("#stats") %>% 
  html_table() %>% 
  clean_names() %>% 
  discard(~all(is.na(.) | . =="")) %>% #for if there are blank columns
  filter(season != "Season") %>% #discard the rows where it just has the names
  retype() %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4)))

league_avg_per_game_stats <- league_web %>% 
  html_element("#stats") %>% 
  html_table %>% 
  row_to_names(row_number = 1) %>%  
  clean_names() %>% 
  discard(~all(is.na(.) | . =="")) %>% #for if there are blank columns
  filter(season != "Season" & season != "") %>%  #discard the rows where it just has the names
  retype() %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4)))

lebron_career_regular_season_per_game <- lebron_web %>% 
  html_element("#per_game") %>% 
  html_table() %>% 
  clean_names() %>% 
  filter(season != "") %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>%
  mutate(player = "Lebron James") %>% 
  retype()

lebron_career_playoffs_per_game <- lebron_web %>% 
  html_element("#div_playoffs_per_game") %>% 
  html_table() %>% 
  clean_names() %>% 
  filter(season != "") %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>% 
  mutate(player = "Lebron James") %>% 
  retype()

jordan_career_regular_season_per_game <- jordan_web %>% 
  html_element("#per_game") %>% 
  html_table() %>% 
  clean_names() %>%
  filter(lg == "NBA") %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>%
  mutate(player = "Michael Jordan") %>% 
  retype()

jordan_career_playoffs_per_game <- jordan_web %>% 
  html_element("#div_playoffs_per_game") %>% 
  html_table() %>% 
  clean_names() %>% 
  filter(season != "") %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>% 
  mutate(player = "Michael Jordan") %>% 
  retype()

three_player_career_regular_season_per_game <- rbind(curry_career_regular_season_per_game,
                                                     lebron_career_regular_season_per_game,
                                                     jordan_career_regular_season_per_game)

three_player_career_playoffs_per_game <- rbind(curry_career_playoffs_per_game,
                                               lebron_career_playoffs_per_game,
                                               jordan_career_playoffs_per_game)

curry_career_regular_season_totals <- curry_web %>% 
  html_element("#totals") %>% 
  html_table() %>% 
  clean_names() %>% 
  discard(~all(is.na(.) | . =="")) %>%
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>%
  mutate(player = "Stephen Curry")

lebron_career_regular_season_totals <- lebron_web %>% 
  html_element("#totals") %>% 
  html_table() %>% 
  clean_names() %>% 
  discard(~all(is.na(.) | . =="")) %>%
  filter(season != "") %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>%
  mutate(player = "Lebron James") %>% 
  retype()

jordan_career_regular_season_totals <- jordan_web %>% 
  html_element("#totals") %>% 
  html_table() %>% 
  clean_names() %>%
  discard(~all(is.na(.) | . =="")) %>%
  filter(lg == "NBA") %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>%
  mutate(player = "Michael Jordan") %>% 
  retype()

three_player_career_regular_season_totals <- rbind(curry_career_regular_season_totals,
                                                     lebron_career_regular_season_totals,
                                                     jordan_career_regular_season_totals)


three_point_career_leaders <- three_point_career_web %>% 
  html_element("#nba") %>% 
  html_table %>%  
  clean_names() 
  
three_point_career_leaders <- na.locf(three_point_career_leaders)

warriors_stats <- read_html("https://www.basketball-reference.com/teams/GSW/stats_per_game_totals.html") %>% 
   html_element("#stats") %>% 
  html_table %>% 
  clean_names()

warriors_stats <- warriors_stats %>% 
  clean_names() %>% 
  discard(~all(is.na(.) | . == "")) %>% 
  filter(season != "Season")
```

```{r, loading in graphs}
league_avg_3pt_graph <- league_avg_per_game_stats %>% 
  mutate(curry_in_league = if_else(season_start_year >= 2009, TRUE, FALSE)) %>% 
  filter(season_start_year >= 1979) %>% 
  ggplot() +
  geom_col(aes(x = season,
               y = x3pa,
               fill = curry_in_league)) +
  geom_vline(xintercept = 30.5,
             linetype = "dashed") +
  annotate("text",
           x = 28,
           y = 33,
           size = 3,
           label = "Stephen Curry \nDrafted in \n2009",
           fontface = 3) +
  labs(title = "League Average of 3PT Attempts per Game",
       x = "",
       y = "Attempts per Game") +
  scale_fill_manual(values=c("#17408B", "#C9082A")) +
  theme_tufte() +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 90, 
                                   vjust = 0.5, 
                                   hjust=1))


three_player_three_point_graph <- three_player_career_regular_season_totals %>% 
  drop_na(season_start_year) %>% 
  ggplot(aes(x = season_start_year,
             y = x3p,
             colour = player)) +
  geom_smooth(se = FALSE) +
  annotate("text",
           x = 1995,
           y = 200,
           label = "Michael Jordan",
           size = 3,
           colour = "#CE1141",
           fontface = 4) +
  annotate("text",
           x = 1995,
           y = 250,
           label = "Lebron James",
           size = 3,
           colour = "#FDBB30",
           fontface = 4) +
  annotate("text",
           x = 1995,
           y = 300,
           label = "Stephen Curry",
           size = 3,
           colour = "#1D428A",
           fontface = 4) +
  labs(title = "3PT Field Goals Made per Season",
       y = "",
       x = "") +
  scale_color_manual(values=c("#FDBB30", "#CE1141", "#1D428A")) + #(Lebron, Jordan, Curry)
  theme_tufte() +
  theme(legend.position = "none")


three_player_point_graph <- three_player_career_regular_season_per_game %>% 
  drop_na(season_start_year) %>% 
  ggplot(aes(x = season_start_year,
             y = pts,
             colour = player)) +
  geom_smooth(se = FALSE) +
  labs(title = "Average Points per Game, per Season",
       y = "",
       x = "") +
  scale_color_manual(values=c("#FDBB30", "#CE1141", "#1D428A")) + #(Lebron, Jordan, Curry)
  theme_tufte() +
  theme(legend.position = "none")


three_player_comparison_graph <- three_player_three_point_graph + three_player_point_graph


three_point_leader_graph <- three_point_career_leaders %>% 
  filter(rank <= 10) %>%
  ggplot(aes(x = x3p,
             y = fct_reorder(player, rank, .desc = TRUE),
             label = x3p,
             fill = player)) +
  geom_col() +
  geom_text(hjust = 1.2,
            fontface = 3,
            size = 3) +
  labs(title = "Top 10 Career Leaders for 3PT Field Goals",
       x = "",
       y = "") +
  scale_fill_manual(values = c("#E03A3E", 
                               "#F58426", 
                               "#CE1141", 
                               "#00538C", 
                               "#E03A3E", 
                               "#007A33", 
                               "#007A33", 
                               "#FDBB30", 
                               "#1D428A", 
                               "#753BBD")) +
  theme_tufte() +
  theme(legend.position = "none")


offensive_rating_graph <- league_avg_per_game_stats %>%
  filter(rk <= 27) %>%
  ggplot(aes(x=season, y=o_rtg, size=x3pa)) + geom_point() + labs(title = "Average NBA Offensive Rating By Season", size = "3PA Per Game", x=NULL, y="Offensive Rating") + theme_tufte() + theme(legend.background = element_rect(color="black"),                                       axis.text.x = element_text(angle = 90,                                                         vjust = 0.5,                                                        hjust = 1))


warriors_season_wins <- warriors_per_game_stats %>%
  filter(season_start_year >= 1979) %>%
  mutate(Curry = season_start_year > 2008) %>%
  filter(w>40) %>%
  arrange(w) %>%
  mutate(season = factor(season, levels=season)) %>%
  ggplot(aes(x=w, 
             y=season, fill=Curry)) + 
  geom_col() + geom_text(aes(label=w),                                                          hjust="right", color = "white") + 
  theme_tufte() + 
  labs(title = "Golden State Warriors Highest Wins in a Season", y=NULL, x="Wins") + 
  scale_fill_manual(values = c("#FFC72C","#1D428A"), 
                    labels = c("Out of League", "In League"))

warriors_3pt_percentage_curry <- warriors_stats %>% 
  slice(1:25) %>% 
  ggplot()+
  geom_col(aes(y = x3p_percent, x = season), fill = "#1D428A")+
  geom_vline(xintercept = 12.47,
             linetype = "dashed",
             size = 1) +
  annotate("text",
           x = 10.5,
           y = 17,
           size = 3.5,
           label = "Stephen Curry \nDrafted in \n2009",
           fontface = 3)+
  labs(title = "Warriors 3PT Percentage Before And After Curry",
       y = "",
       x = "Season")+
  theme_tufte()+
  theme(axis.text.x = element_text(angle = 90,
                                   vjust = 0.5,
                                   hjust = 1))
```
















  We knew that we wanted to do our final project regarding sports. Eventually, we narrowed it down to basketball and, more specifically, we are going to follow Steph Curry’s career and his effect on the league. By looking at the year in which he got drafted in comparison to the league as well as his team’s statistics before and after his draft, we can begin to draw conclusion in regards to his impact. Additionally, we will compare his game statistics to other NBA legends and three point specialists. Through this context, we began to ask ourselves a set of research questions to guide our data collection, wrangling, and visualization.
  To begin with, the overarching question we are asking ourselves is: how did Stephen Curry change the game of basketball in the NBA from his draft in 2009? We will look at three point statistics to dive into this one even more. Additionally, we are asking how did the game during another great’s time, like Michael Jordan, differentiate from the modern game. By looking at their differences in statistics we will be able to come to different conclusions regarding the style of play and the intricacies of what skills the coaches and players are hoping to perfect to be competitive in the league. Finally, we will also compre Lebron James, Michael Jordan and Steph Curry to measure which one was more productive.

# Our Data

  In terms of data collection, we relied on a website called [Basketball Reference](https://www.basketball-reference.com/) which provides in depth statistics about individual players and all the teams in the league. We focused on Steph Curry, the Warriors, and the overall league data when we were looking at the data to make sure that we had enough points to answer our research questions. To actually attain our data, we had to use the selector gadget extension and then use the html functions to create tables and datasets that worked. Some parts of the website were not compatible with the extension which meant that we had to change our initial ideas and adapt to what the extensions were able to get from the website. Fortunately, we had enough data from the individual players and teams that we did not need all the data we originally set out to have. Once we had our data, we worked on cleaning it up because the selector gadget, sometimes, does not give out the cleanest and easiest data to work with. However, by using the janitor library and its functions we were able to make the dataset a lot more accessible and ready to use.
