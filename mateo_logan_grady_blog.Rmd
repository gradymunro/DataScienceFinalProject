---
title: 'Steph Curry: The Game Changer'
author: Grady Munro, Logan Pampel, and Mateo Useche Rosania
output: 
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    code_download: true
    theme: cerulean
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)
```

```{r, libraries}
library(readr)
library(tidyverse)     # for data cleaning and plotting
library(lubridate)     # for date manipulation
library(openintro)     # for the abbr2state() function
library(maps)          # for map data
library(ggmap)         # for mapping points on maps
library(gplots)        # for col2hex() function
library(RColorBrewer)  # for color palettes
library(sf)            # for working with spatial data
library(leaflet)       # for highly customizable mapping
library(ggthemes)      # for more themes (including theme_map())
library(plotly)        # for the ggplotly() - basic interactivity
library(gganimate)     # for adding animation layers to ggplots
library(gifski)        # for creating the gif (don't need to load this library every time,but need it installed)
library(transformr)    # for "tweening" (gganimate)
library(shiny)         # for creating interactive apps
library(patchwork)     # for nicely combining ggplot2 graphs  
library(gt)            # for creating nice tables
library(rvest)         # for scraping data
library(robotstxt)     # for checking if you can scrape data
library(janitor)
library(reshape2)
library(hablar) # Might need to install the hablar package, this gives you the retype function.
library(zoo)
```

```{r, reading in data}
curry_web <- read_html("https://www.basketball-reference.com/players/c/curryst01.html")
warriors_web <- read_html("https://www.basketball-reference.com/teams/GSW/stats_per_game_totals.html")
league_web <- read_html("https://www.basketball-reference.com/leagues/NBA_stats_per_game.html")
lebron_web <- read_html("https://www.basketball-reference.com/players/j/jamesle01.html")
jordan_web <- read_html("https://www.basketball-reference.com/players/j/jordami01.html")
three_point_career_web <- read_html("https://www.basketball-reference.com/leaders/fg3_career.html")

curry_career_regular_season_per_game <- curry_web %>% 
  html_element("#per_game") %>% 
  html_table() %>% 
  clean_names() %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>%
  mutate(player = "Stephen Curry")

curry_career_playoffs_per_game <- curry_web %>% 
  html_element("#div_playoffs_per_game") %>% 
  html_table() %>% 
  clean_names() %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>% 
  mutate(player = "Stephen Curry")

warriors_per_game_stats <- warriors_web %>% 
  html_element("#stats") %>% 
  html_table() %>% 
  clean_names() %>% 
  discard(~all(is.na(.) | . =="")) %>% #for if there are blank columns
  filter(season != "Season") %>% #discard the rows where it just has the names
  retype() %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4)))

league_avg_per_game_stats <- league_web %>% 
  html_element("#stats") %>% 
  html_table %>% 
  row_to_names(row_number = 1) %>%  
  clean_names() %>% 
  discard(~all(is.na(.) | . =="")) %>% #for if there are blank columns
  filter(season != "Season" & season != "") %>%  #discard the rows where it just has the names
  retype() %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4)))

lebron_career_regular_season_per_game <- lebron_web %>% 
  html_element("#per_game") %>% 
  html_table() %>% 
  clean_names() %>% 
  filter(season != "") %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>%
  mutate(player = "Lebron James") %>% 
  retype()

lebron_career_playoffs_per_game <- lebron_web %>% 
  html_element("#div_playoffs_per_game") %>% 
  html_table() %>% 
  clean_names() %>% 
  filter(season != "") %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>% 
  mutate(player = "Lebron James") %>% 
  retype()

jordan_career_regular_season_per_game <- jordan_web %>% 
  html_element("#per_game") %>% 
  html_table() %>% 
  clean_names() %>%
  filter(lg == "NBA") %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>%
  mutate(player = "Michael Jordan") %>% 
  retype()

jordan_career_playoffs_per_game <- jordan_web %>% 
  html_element("#div_playoffs_per_game") %>% 
  html_table() %>% 
  clean_names() %>% 
  filter(season != "") %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>% 
  mutate(player = "Michael Jordan") %>% 
  retype()

three_player_career_regular_season_per_game <- rbind(curry_career_regular_season_per_game,
                                                     lebron_career_regular_season_per_game,
                                                     jordan_career_regular_season_per_game)

three_player_career_playoffs_per_game <- rbind(curry_career_playoffs_per_game,
                                               lebron_career_playoffs_per_game,
                                               jordan_career_playoffs_per_game)

curry_career_regular_season_totals <- curry_web %>% 
  html_element("#totals") %>% 
  html_table() %>% 
  clean_names() %>% 
  discard(~all(is.na(.) | . =="")) %>%
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>%
  mutate(player = "Stephen Curry")

lebron_career_regular_season_totals <- lebron_web %>% 
  html_element("#totals") %>% 
  html_table() %>% 
  clean_names() %>% 
  discard(~all(is.na(.) | . =="")) %>%
  filter(season != "") %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>%
  mutate(player = "Lebron James") %>% 
  retype()

jordan_career_regular_season_totals <- jordan_web %>% 
  html_element("#totals") %>% 
  html_table() %>% 
  clean_names() %>%
  discard(~all(is.na(.) | . =="")) %>%
  filter(lg == "NBA") %>% 
  mutate(season_start_year = as.integer(substr(season, 1, 4))) %>%
  mutate(player = "Michael Jordan") %>% 
  retype()

three_player_career_regular_season_totals <- rbind(curry_career_regular_season_totals,
                                                     lebron_career_regular_season_totals,
                                                     jordan_career_regular_season_totals)


three_point_career_leaders <- three_point_career_web %>% 
  html_element("#nba") %>% 
  html_table %>%  
  clean_names() 
  
three_point_career_leaders <- na.locf(three_point_career_leaders)

warriors_stats <- read_html("https://www.basketball-reference.com/teams/GSW/stats_per_game_totals.html") %>% 
   html_element("#stats") %>% 
  html_table %>% 
  clean_names()

warriors_stats <- warriors_stats %>% 
  clean_names() %>% 
  discard(~all(is.na(.) | . == "")) %>% 
  filter(season != "Season")
```

```{r, loading in graphs}
league_avg_3pt_graph <- league_avg_per_game_stats %>% 
  mutate(curry_in_league = if_else(season_start_year >= 2009, TRUE, FALSE)) %>% 
  filter(season_start_year >= 1979) %>% 
  ggplot() +
  geom_col(aes(x = season,
               y = x3pa,
               fill = curry_in_league)) +
  geom_vline(xintercept = 30.5,
             linetype = "dashed") +
  annotate("text",
           x = 28,
           y = 33,
           size = 3,
           label = "Stephen Curry \nDrafted in \n2009",
           fontface = 3) +
  labs(title = "League Average of 3PT Attempts per Game",
       x = "",
       y = "Attempts per Game") +
  scale_fill_manual(values=c("#17408B", "#C9082A")) +
  theme_tufte() +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 90, 
                                   vjust = 0.5, 
                                   hjust=1))


three_player_three_point_graph <- three_player_career_regular_season_totals %>% 
  drop_na(season_start_year) %>% 
  ggplot(aes(x = season_start_year,
             y = x3p,
             colour = player)) +
  geom_smooth(se = FALSE) +
  annotate("text",
           x = 1995,
           y = 200,
           label = "Michael Jordan",
           size = 3,
           colour = "#CE1141",
           fontface = 4) +
  annotate("text",
           x = 1995,
           y = 250,
           label = "Lebron James",
           size = 3,
           colour = "#FDBB30",
           fontface = 4) +
  annotate("text",
           x = 1995,
           y = 300,
           label = "Stephen Curry",
           size = 3,
           colour = "#1D428A",
           fontface = 4) +
  labs(title = "3PT Field Goals Made per Season",
       y = "",
       x = "") +
  scale_color_manual(values=c("#FDBB30", "#CE1141", "#1D428A")) + #(Lebron, Jordan, Curry)
  theme_tufte() +
  theme(legend.position = "none")


three_player_point_graph <- three_player_career_regular_season_per_game %>% 
  drop_na(season_start_year) %>% 
  ggplot(aes(x = season_start_year,
             y = pts,
             colour = player)) +
  geom_smooth(se = FALSE) +
  labs(title = "Average Points per Game, per Season",
       y = "",
       x = "") +
  scale_color_manual(values=c("#FDBB30", "#CE1141", "#1D428A")) + #(Lebron, Jordan, Curry)
  theme_tufte() +
  theme(legend.position = "none")


three_player_comparison_graph <- three_player_three_point_graph + three_player_point_graph


three_point_leader_graph <- three_point_career_leaders %>% 
  filter(rank <= 10) %>%
  ggplot(aes(x = x3p,
             y = fct_reorder(player, rank, .desc = TRUE),
             label = x3p,
             fill = player)) +
  geom_col() +
  geom_text(hjust = 1.2,
            fontface = 3,
            size = 3) +
  labs(title = "Top 10 Career Leaders for 3PT Field Goals",
       x = "",
       y = "") +
  scale_fill_manual(values = c("#E03A3E", 
                               "#F58426", 
                               "#CE1141", 
                               "#00538C", 
                               "#E03A3E", 
                               "#007A33", 
                               "#007A33", 
                               "#FDBB30", 
                               "#1D428A", 
                               "#753BBD")) +
  theme_tufte() +
  theme(legend.position = "none")


offensive_rating_graph <- league_avg_per_game_stats %>%
  filter(rk <= 27) %>%
  ggplot(aes(x=season, y=o_rtg, size=x3pa)) + geom_point() + labs(title = "Average NBA Offensive Rating By Season", size = "3PA Per Game", x=NULL, y="Offensive Rating") + theme_tufte() + theme(legend.background = element_rect(color="black"),                                       axis.text.x = element_text(angle = 90,                                                         vjust = 0.5,                                                        hjust = 1))


warriors_season_wins <- warriors_per_game_stats %>%
  filter(season_start_year >= 1979) %>%
  mutate(Curry = season_start_year > 2008) %>%
  filter(w>40) %>%
  arrange(w) %>%
  mutate(season = factor(season, levels=season)) %>%
  ggplot(aes(x=w, 
             y=season, fill=Curry)) + 
  geom_col() + geom_text(aes(label=w),                                                          hjust="right", color = "white") + 
  theme_tufte() + 
  labs(title = "Golden State Warriors Highest Wins in a Season", y=NULL, x="Wins") + 
  scale_fill_manual(values = c("#FFC72C","#1D428A"), 
                    labels = c("Out of League", "In League"))

warriors_3pt_percentage_curry <- warriors_stats %>% 
  slice(1:25) %>% 
  ggplot()+
  geom_col(aes(y = x3p_percent, x = season), fill = "#1D428A")+
  geom_vline(xintercept = 12.47,
             linetype = "dashed",
             size = 1) +
  annotate("text",
           x = 10.5,
           y = 17,
           size = 3.5,
           label = "Stephen Curry \nDrafted in \n2009",
           fontface = 3)+
  labs(title = "Warriors 3PT Percentage Before And After Curry",
       y = "",
       x = "Season")+
  theme_tufte()+
  theme(axis.text.x = element_text(angle = 90,
                                   vjust = 0.5,
                                   hjust = 1))
```

# Introduction

  We knew that we wanted to do our final project regarding sports. Eventually, we narrowed it down to basketball, and, more specifically, we will follow Stephen Curry’s career and his effect on the league. By looking at the year in which he got drafted in comparison to the league, as well as his team’s statistics before and after his draft, we can begin to draw conclusions in regards to his impact. Additionally, we will compare his game statistics to other NBA legends and three-point specialists. With this context in mind, we began to ask ourselves a set of research questions to guide our data collection, wrangling, and visualization.
  
  When analyzing Stephen Curry’s impact on the NBA, we have three research questions that we want to answer. The first question is: How does Stephen Curry compare to the two greatest of all time, Michael Jordan and Lebron James? To look at Curry’s impact on the league, we must first look at his individual play to see if he belongs in the same category as the greats. The second question is: How has Stephen Curry impacted the Golden State Warriors since he was drafted? The mark of a great leader and player is that he can elevate the team around him, and in order to prove yourself to the league you must first prove yourself to your team. Our third and final question is: How has Stephen Curry changed the nature of the NBA? Since Curry came into the league, there has been a lot of talk about his impact on the NBA. Most people seem to agree that he has had an extraordinary impact, and we want to see if the data supports this claim.

# Our Data

  In terms of data collection, we relied on a website called [Basketball Reference](https://www.basketball-reference.com/) which provides in depth statistics about individual players and all the teams in the league. We focused on Stephen Curry, the Warriors, and the overall league data in order to meet the needs of our three research questions. To actually attain our data, we had to use the selector gadget extension and then use the HTML functions to create tables and datasets that worked. Some parts of the website were not compatible with the extension, which meant that we had to change our initial ideas and adapt to what the extensions were able to get from the website. Fortunately, we had enough data from the individual players and teams that we did not need all the data we originally set out to get. Once we had our data, we worked on cleaning it up because the selector gadget does not always give out the cleanest and easiest data to work with. However, by using the janitor library and its functions, we made the dataset a lot more accessible and ready to use. 

# Curry Individual Play

  We want to start off with: How does Stephen Curry compare to the two greatest basketball players of all time? We will compare these three players using two statistics, their three-pointers made per season, and their average points per game, per season. When looking at three-pointers, it’s not even close. The graph on the left shows the differences in playstyle between the three players. Michael Jordan did not incorporate three-pointers into his game, and it shows, with his best season for this metric not even reaching 100. Lebron James has a more varied playstyle and has incorporated more three-pointers in recent years. Curry is clearly unmatched when it comes to three-pointers, but how about points in general? The graph on the right shows how the three players compare with average points per game. This is where things even out, and we see just how dominant Jordan was. Jordan by far had the highest average points per game, but he saw a sharp decline towards the end of his career. Lebron has had some ups and downs over his career, but he consistently averages between 25 and 30 points per game. Curry falls lowest on this graph, but he clearly has the sharpest takeoff. Curry skyrocketed from the start of his career to match Lebron. He tracks slightly below, but not by much. Both Curry and Lebron look to be on the rise, and it will be interesting to see how they perform in the future. Overall, Curry is comparable to the two greats in these two measures, however, a more holistic analysis would be needed to truly say whether he truly matches up to them. 
  
```{r}
three_player_comparison_graph
```

  As a short addition to our comparison, we will move into a comparison across three-point shooters over the course of the league. Stephen Curry is clearly the greatest three-point shooter of all time. He holds the record for most career three-pointers, and he also holds the record for most three-pointers in a single season. Looking at the graph below, Ray Allen was a hall of fame player who no one thought could be beaten. However, Curry has smashed that record and has the potential to build such a lead that no one could catch him. Again, Curry is the greatest three-point shooter the league has ever seen, and he will likely be the best for many years to come.

```{r}
three_point_leader_graph
```

# Warriors

  We have seen how Curry matches up with two NBA legends: Lebron James and Michael Jordan. After showing that he matches up, individually, with two of the NBA’s best players, we also wanted to look at what impact Curry has had on the Warriors since he has played for them. Individual accolades are one thing, but making your team better through your style of play is what really makes a player one of the all-time bests. The best way to measure a player’s impact is to measure what basketball is all about: wins. We took all of the Warriors seasons since the three point line had been installed in the NBA and examined how many of the top seasons in the Warriors franchise have been with Curry-led Warrior’s teams. As we can see, Curry has been a part of the top 5 winningest teams of the Warriors and has been a part of 8 of the top 16 winningest teams. This proves that the style of basketball that Curry has ushered into the NBA is a successful winning style.

```{r}
warriors_season_wins
```
  
  Additionally, by looking at the Warriors' three-point percentage average per season, we can see a trend in the team’s three-point percentage. As soon as Curry got drafted, the percentage increased significantly. There are a lot of factors that could go into this; however, it is important to note that Curry’s influence was a major factor in this trend. For example, having such a good shooter in your team will motivate other teammates to improve their own skills, and if the coach decides to build the team around Curry and other shooters, the team will completely switch to a shooting team. In the Warriors' case, this is exactly what happened. Steve Kerr, their coach, turned the team into a shooting team that dominated the NBA through Curry and Klay Thompson's three-pointers. Although we cannot say that Curry was the only factor that led to these statistics, we can say that Curry changed the game on a grand scale and had something to do with this. 
  
```{r}
warriors_3pt_percentage_curry
```

# League (NBA)

  We will start off by looking at the league’s average three-point attempts per game through different seasons before and after Curry got drafted. This graph visualizes the fact that three-point attempts had been gradually increasing throughout time; nonetheless, once Curry got drafted in 2009 the attempts of three-point attempts seemed to exponentially increase. This first observation helps us make the claim that Curry began to change the style of play in the NBA. Before, the game did not revolve so much around three-pointers and sharpshooters; however, once he began playing with his style of shooting, it impacted the league substantially. The increase in three-point attempts can be ascribed to the fact that coaches saw the potential in shooting, so their scouts made it clear that shooting was necessary for recruits. Furthermore, kids and teenagers that grew up with Curry’s shooting now will be motivated to imitate him and, subsequently, bring three-point shooting into the league. Through the coaches/staff and his influence on people watching him, Curry was able to change the style of play in the NBA to one that prioritizes shooting and three-pointers. 

```{r}
league_avg_3pt_graph
```

  As we know, Stephen Curry’s three-point sharpshooting and floor spacing led to a significant increase in three-point attempts throughout the entire league. This new style of basketball that Curry and the Warriors adapted with a high volume of three-pointers led to a refreshing and enjoyable new game starting to be played. As refreshing and exciting as this style of play was to watch, we want to see if this new style of play actually led to a better and more efficient offense. We use the statistic of the average NBA offensive rating to help measure the effectiveness of NBA offense from season to season. The offensive rating statistic is the average points an NBA team scores per 100 possessions, this way, the statistic is consistent and does not take into account changes in pace across eras of the NBA and differing amount of average possessions per game. We compare the NBA offensive ratings across 26 seasons with Curry’s rookie season as a median point. As the graph shows, as Curry entered the league, there was a steady increase in three-point shots attempted per game, and the offensive rating stayed in a similar range, even showing a slight decrease. As Curry becomes more popular and the Warriors become more successful (the 2013-2016 range), the three-point attempts increase even more into the 30s per game, and the average offensive rating also increases along with it to all-time highs from 2017-present. When the average three-point attempts per game first started to increase, the efficiency might not have increased with it or matched the attempts, but as three-point shooting became more essential to all players, players began to specialize in it, and coaches began to use it to increase their offensive efficiency, as we can now see an upward trend in the data.

```{r}
offensive_rating_graph
```

# Conclusion


